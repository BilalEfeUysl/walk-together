{% extends "base.html" %} {% block content %}
<div class="bg-background-light dark:bg-background-dark min-h-screen">
  <div class="flex-1 w-full max-w-[1280px] mx-auto p-6 md:p-8">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
      <aside class="lg:col-span-4 xl:col-span-3 sticky top-24 space-y-6">
        <div
          class="bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-slate-700/50 flex flex-col items-center text-center relative overflow-hidden group"
        >
          <div
            class="absolute top-0 left-0 w-full h-24 bg-gradient-to-b from-primary/10 to-transparent"
          ></div>

          <div class="relative z-10 mt-4 mb-4">
            <div
              class="bg-center bg-no-repeat bg-cover rounded-full size-32 shadow-lg border-4 border-white dark:border-slate-700"
              style="background-image: url('{{ user[7] if user[7] else 'https://ui-avatars.com/api/?name=' + user[1] }}');"
            ></div>
            <div
              class="absolute -bottom-3 left-1/2 -translate-x-1/2 rounded-full px-3 py-1 shadow-md border flex items-center gap-1 whitespace-nowrap {{ user_rank_color }}"
            >
              <span class="material-symbols-outlined text-[16px] fill-1"
                >verified</span
              >
              <span class="text-xs font-bold uppercase tracking-wider"
                >{{ user_level }}</span
              >
            </div>
          </div>

          <h1
            class="text-[#131614] dark:text-white text-2xl font-bold font-stylish mt-4"
          >
            {{ user[1] }}
          </h1>
          <p class="text-sage-text text-sm mb-4">Doƒüa Tutkunu üå≤</p>

          <p
            class="text-[#131614] dark:text-slate-300 text-sm leading-relaxed mb-6 opacity-80"
          >
            {{ user[6] if user[6] else "Hen√ºz bir biyografi eklenmemi≈ü." }}
          </p>

          <div
            class="flex items-center justify-center gap-4 text-xs text-sage-text mb-4"
          >
            {% if user[8] %}
            <span class="flex items-center gap-1">
              <span class="material-symbols-outlined text-[14px]">cake</span> {{
              user[8].strftime('%d.%m.%Y') }}
            </span>
            {% endif %} {% if user[9] and user[9] != 'Unspecified' %}
            <span class="flex items-center gap-1">
              <span class="material-symbols-outlined text-[14px]">
                {{ 'male' if user[9] == 'Male' else 'female' }}
              </span>
              {{ 'Erkek' if user[9] == 'Male' else 'Kadƒ±n' }}
            </span>
            {% endif %}
          </div>

          <div
            class="grid grid-cols-3 gap-2 w-full mb-6 border-t border-b border-dashed border-gray-200 dark:border-slate-700 py-4"
          >
            <div class="flex flex-col items-center">
              <span class="text-lg font-bold text-[#131614] dark:text-white"
                >{{ created_routes|length }}</span
              >
              <span
                class="text-xs text-sage-text font-medium uppercase tracking-wide"
                >Rota</span
              >
            </div>
            <div
              class="flex flex-col items-center border-l border-gray-100 dark:border-slate-700"
            >
              <span class="text-lg font-bold text-[#131614] dark:text-white"
                >{{ friends|length }}</span
              >
              <span
                class="text-xs text-sage-text font-medium uppercase tracking-wide"
                >Arkada≈ü</span
              >
            </div>
            <div
              class="flex flex-col items-center border-l border-gray-100 dark:border-slate-700"
            >
              <span class="text-lg font-bold text-green-600"
                >{{ user[4] }}</span
              >
              <span
                class="text-xs text-sage-text font-medium uppercase tracking-wide"
                >Puan</span
              >
            </div>
          </div>

          {% if session.get('user_id') == user[0] %}
          <a
            href="{{ url_for('main.edit_profile') }}"
            class="w-full flex items-center justify-center gap-2 rounded-xl h-10 px-4 border border-primary/30 text-primary dark:text-green-400 hover:bg-primary hover:text-white transition-all text-sm font-bold"
          >
            <span class="material-symbols-outlined text-[18px]">edit</span>
            Profili D√ºzenle
          </a>
          {% else %}
          <a
            href="{{ url_for('main.add_friend', target_id=user[0]) }}"
            class="w-full flex items-center justify-center gap-2 rounded-xl h-10 px-4 bg-primary text-white hover:bg-primary-dark transition-all text-sm font-bold"
          >
            <span class="material-symbols-outlined text-[18px]"
              >person_add</span
            >
            Arkada≈ü Ekle
          </a>
          {% endif %}
        </div>
      </aside>

      <main class="lg:col-span-8 xl:col-span-9 flex flex-col gap-8">
        <div class="border-b border-gray-200 dark:border-slate-700">
          <div class="flex gap-8 overflow-x-auto no-scrollbar" id="profileTabs">
            <button
              onclick="switchTab('overview')"
              id="tab-overview"
              class="tab-btn pb-3 border-b-[3px] border-primary text-[#131614] dark:text-white flex items-center gap-2 group whitespace-nowrap active"
            >
              <span class="material-symbols-outlined text-[20px]"
                >dashboard</span
              >
              <span class="text-sm font-bold">Genel Bakƒ±≈ü</span>
            </button>
            <button
              onclick="switchTab('routes')"
              id="tab-routes"
              class="tab-btn pb-3 border-b-[3px] border-transparent text-sage-text hover:text-primary transition-all flex items-center gap-2 group whitespace-nowrap"
            >
              <span class="material-symbols-outlined text-[20px]">map</span>
              <span class="text-sm font-bold"
                >Rotalar ({{ created_routes|length }})</span
              >
            </button>
            <button
              onclick="switchTab('events')"
              id="tab-events"
              class="tab-btn pb-3 border-b-[3px] border-transparent text-sage-text hover:text-primary transition-all flex items-center gap-2 group whitespace-nowrap"
            >
              <span class="material-symbols-outlined text-[20px]">event</span>
              <span class="text-sm font-bold"
                >Etkinlikler ({{ upcoming_events|length + past_events|length +
                organized_events|length }})</span
              >
            </button>
            <button
              onclick="switchTab('clubs')"
              id="tab-clubs"
              class="tab-btn pb-3 border-b-[3px] border-transparent text-sage-text hover:text-primary transition-all flex items-center gap-2 group whitespace-nowrap"
            >
              <span class="material-symbols-outlined text-[20px]">groups</span>
              <span class="text-sm font-bold"
                >Kul√ºpler ({{ clubs|length if clubs else 0 }})</span
              >
            </button>
          </div>
        </div>

        <div id="content-overview" class="tab-content block space-y-8">
          <section>
            <h3
              class="text-xl font-bold text-[#131614] dark:text-white mb-4 flex items-center gap-2"
            >
              <span class="material-symbols-outlined text-green-600"
                >favorite</span
              >
              ƒ∞lgi Alanlarƒ±
            </h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
              {% for hobby in hobbies %}
              <div
                class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm border border-gray-100 dark:border-slate-700 flex flex-col items-center text-center gap-2 hover:-translate-y-1 transition-transform cursor-default group"
              >
                <div
                  class="size-12 bg-green-50 dark:bg-green-900/20 rounded-full flex items-center justify-center text-green-600 dark:text-green-400 mb-1 group-hover:bg-green-100 transition-colors"
                >
                  <i
                    class="{{ hobby[1] if hobby[1] else 'fas fa-star' }} text-xl"
                  ></i>
                </div>
                <p class="font-bold text-sm text-slate-900 dark:text-white">
                  {{ hobby[0] }}
                </p>
              </div>
              {% else %}
              <div
                class="col-span-4 text-center py-4 bg-slate-50 dark:bg-slate-800/50 rounded-xl border border-dashed border-slate-200"
              >
                <p class="text-sm text-sage-text">Hen√ºz hobi eklenmemi≈ü.</p>
              </div>
              {% endfor %}
            </div>
          </section>

          <section>
            <div class="flex justify-between items-end mb-4">
              <h3 class="text-xl font-bold text-[#131614] dark:text-white">
                Rozetler & Ba≈üarƒ±lar
              </h3>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
              {% for badge in badges %}
              <div
                class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm border border-gray-100 dark:border-slate-700 flex flex-col items-center text-center gap-2 hover:-translate-y-1 transition-transform cursor-default"
              >
                <div
                  class="size-12 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center text-primary dark:text-green-400 mb-1"
                >
                  {% if badge[1] and 'fas' in badge[1] %}
                  <i class="{{ badge[1] }} text-xl"></i>
                  {% else %}
                  <span class="material-symbols-outlined text-[28px] fill-1"
                    >stars</span
                  >
                  {% endif %}
                </div>
                <p class="font-bold text-sm text-slate-900 dark:text-white">
                  {{ badge[0] }}
                </p>
                <p class="text-xs text-sage-text">{{ badge[2] }}</p>
              </div>
              {% else %}
              <div
                class="col-span-4 text-center py-6 bg-slate-50 dark:bg-slate-800/50 rounded-xl border border-dashed border-slate-200"
              >
                <p class="text-slate-500 text-sm">
                  Hen√ºz kazanƒ±lmƒ±≈ü bir rozet yok. Y√ºr√ºy√º≈üe ba≈üla! üö∂‚Äç‚ôÇÔ∏è
                </p>
              </div>
              {% endfor %}
            </div>
          </section>
        </div>

        <div id="content-routes" class="tab-content hidden space-y-6">
          <h3 class="text-xl font-bold text-[#131614] dark:text-white mb-4">
            Olu≈üturulan Rotalar
          </h3>
          {% for route in created_routes %}
          <div class="flex gap-6 relative group">
            <div class="flex flex-col items-center relative z-10">
              <div
                class="size-10 bg-white dark:bg-slate-800 border-2 border-sage-text/30 rounded-full flex items-center justify-center shadow-sm"
              >
                <span
                  class="material-symbols-outlined text-sage-text text-[20px]"
                  >map</span
                >
              </div>
            </div>
            <div
              class="flex-1 bg-white dark:bg-slate-800 rounded-2xl p-4 shadow-sm border border-gray-100 dark:border-slate-700 hover:shadow-md transition-shadow"
            >
              <div class="flex flex-col sm:flex-row gap-4">
                <div
                  class="w-full sm:w-32 h-32 sm:h-auto bg-gray-100 dark:bg-slate-700 rounded-xl bg-center bg-cover flex-shrink-0"
                  style="background-image: url('https://loremflickr.com/200/200/map,route?lock={{ route[0] }}');"
                ></div>
                <div class="flex-1 py-1">
                  <h4 class="font-bold text-lg text-[#131614] dark:text-white">
                    {{ route[1] }}
                  </h4>
                  <div
                    class="flex items-center gap-4 text-sm font-medium text-[#131614] dark:text-slate-300 mt-2"
                  >
                    <div
                      class="flex items-center gap-1 bg-background-light dark:bg-slate-700 px-2 py-1 rounded-md"
                    >
                      <span
                        class="material-symbols-outlined text-sage-text text-[18px]"
                        >straighten</span
                      >
                      {{ route[2] }} km
                    </div>
                    <div
                      class="flex items-center gap-1 bg-background-light dark:bg-slate-700 px-2 py-1 rounded-md"
                    >
                      <span
                        class="material-symbols-outlined text-sage-text text-[18px]"
                        >terrain</span
                      >
                      {{ route[3] }}
                    </div>
                  </div>
                  <div class="mt-3">
                    <a
                      href="{{ url_for('main.route_detail', route_id=route[0]) }}"
                      class="text-sm font-bold text-primary hover:underline"
                      >Rotayƒ± ƒ∞ncele</a
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>
          {% else %}
          <p class="text-gray-500">Hen√ºz olu≈üturulan bir rota yok.</p>
          {% endfor %}
        </div>

        <div id="content-events" class="tab-content hidden space-y-6">
          <div class="flex gap-4 mb-6">
            <button
              onclick="switchEventSubTab('upcoming')"
              id="subtab-upcoming"
              class="px-4 py-2 rounded-full text-sm font-bold transition-colors bg-primary text-white subtab-btn"
            >
              Yakla≈üan
            </button>
            <button
              onclick="switchEventSubTab('completed')"
              id="subtab-completed"
              class="px-4 py-2 rounded-full text-sm font-bold transition-colors bg-gray-100 text-slate-600 hover:bg-gray-200 dark:bg-slate-800 dark:text-slate-300 subtab-btn"
            >
              Tamamlanan
            </button>
            <button
              onclick="switchEventSubTab('created')"
              id="subtab-created"
              class="px-4 py-2 rounded-full text-sm font-bold transition-colors bg-gray-100 text-slate-600 hover:bg-gray-200 dark:bg-slate-800 dark:text-slate-300 subtab-btn"
            >
              Olu≈üturulan
            </button>
          </div>
          <div id="event-content-upcoming" class="event-subcontent block">
            {% for event in upcoming_events %}
            <div class="flex gap-6 relative group mb-6">
              <div class="flex flex-col items-center relative z-10">
                <div
                  class="size-10 bg-white dark:bg-slate-800 border-2 border-primary rounded-full flex items-center justify-center shadow-sm group-hover:scale-110 transition-transform"
                >
                  <span
                    class="material-symbols-outlined text-primary text-[20px]"
                    >event_upcoming</span
                  >
                </div>
              </div>
              <div
                class="flex-1 bg-white dark:bg-slate-800 rounded-2xl p-4 shadow-sm border border-gray-100 dark:border-slate-700 hover:shadow-md transition-shadow"
              >
                <h4 class="font-bold text-lg text-[#131614] dark:text-white">
                  {{ event[4] }}
                </h4>
                <p class="text-xs text-sage-text font-medium mt-1">
                  {{ event[2] }}
                </p>
                <a
                  href="{{ url_for('main.event_detail', event_id=event[0]) }}"
                  class="text-sm font-bold text-primary hover:underline mt-2 inline-block"
                  >Detaylar</a
                >
              </div>
            </div>
            {% else %}
            <p class="text-gray-500 py-4">Yakla≈üan etkinlik yok.</p>
            {% endfor %}
          </div>

          <div id="event-content-completed" class="event-subcontent hidden">
            {% for event in past_events %}
            <div class="flex gap-6 relative group mb-6">
              <div class="flex flex-col items-center relative z-10">
                <div
                  class="size-10 bg-gray-100 dark:bg-slate-700 border-2 border-gray-300 rounded-full flex items-center justify-center shadow-sm"
                >
                  <span
                    class="material-symbols-outlined text-gray-500 text-[20px]"
                    >check_circle</span
                  >
                </div>
              </div>
              <div
                class="flex-1 bg-white dark:bg-slate-800 rounded-2xl p-4 shadow-sm border border-gray-100 dark:border-slate-700 opacity-80 hover:opacity-100 transition-opacity"
              >
                <div class="flex-1 py-1">
                  <h4 class="font-bold text-lg text-[#131614] dark:text-white">
                    {{ event[4] }}
                  </h4>
                  <p class="text-xs text-sage-text font-medium mt-1">
                    {{ event[2] }}
                  </p>
                  <p class="text-sm text-gray-600 dark:text-slate-400 mt-2">
                    Tamamlandƒ± ‚Ä¢ {{ event[3] }} km
                  </p>
                  <a
                    href="{{ url_for('main.event_detail', event_id=event[0]) }}"
                    class="text-sm font-bold text-primary hover:underline mt-2 inline-block"
                    >Tekrar ƒ∞ncele</a
                  >
                </div>
              </div>
            </div>
            {% else %}
            <p class="text-gray-500 py-4">
              Hen√ºz tamamlanmƒ±≈ü etkinlik kaydƒ± yok.
            </p>
            {% endfor %}
          </div>

          <div id="event-content-created" class="event-subcontent hidden">
            {% for event in organized_events %}
            <div class="flex gap-6 relative group mb-6">
              <div class="flex flex-col items-center relative z-10">
                <div
                  class="size-10 bg-white dark:bg-slate-800 border-2 border-purple-500 rounded-full flex items-center justify-center shadow-sm"
                >
                  <span
                    class="material-symbols-outlined text-purple-500 text-[20px]"
                    >campaign</span
                  >
                </div>
              </div>
              <div
                class="flex-1 bg-white dark:bg-slate-800 rounded-2xl p-4 shadow-sm border border-gray-100 dark:border-slate-700 hover:shadow-md transition-shadow"
              >
                <div class="flex-1 py-1">
                  <div class="flex justify-between items-start">
                    <h4
                      class="font-bold text-lg text-[#131614] dark:text-white"
                    >
                      {{ event[5] }}
                    </h4>
                    <span
                      class="text-xs font-bold px-2 py-1 rounded bg-purple-100 text-purple-700"
                      >Organizator</span
                    >
                  </div>
                  <p class="text-xs text-sage-text font-medium mt-1">
                    {{ event[2] }}
                  </p>
                  <p class="text-sm text-gray-600 dark:text-slate-400 mt-2">
                    Katƒ±lƒ±mcƒ±: {{ event[4] }} Ki≈üi
                  </p>
                  <a
                    href="{{ url_for('main.event_detail', event_id=event[0]) }}"
                    class="text-sm font-bold text-primary hover:underline mt-2 inline-block"
                    >Y√∂net</a
                  >
                </div>
              </div>
            </div>
            {% else %}
            <p class="text-gray-500 py-4">
              Hen√ºz olu≈üturduƒüun bir etkinlik yok.
            </p>
            {% endfor %}
          </div>
        </div>

        <div id="content-clubs" class="tab-content hidden space-y-6">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold text-[#131614] dark:text-white">
              √úye Olunan Kul√ºpler
            </h3>
            <a
              href="{{ url_for('main.create_club') }}"
              class="text-sm font-bold text-primary hover:underline"
              >Yeni Kul√ºp Kur</a
            >
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            {% if clubs %} {% for club in clubs %}
            <a
              href="{{ url_for('main.club_detail', club_id=club[0]) }}"
              class="group block"
            >
              <div
                class="bg-white dark:bg-slate-800 rounded-2xl p-4 shadow-sm border border-gray-100 dark:border-slate-700 hover:shadow-md transition-all flex items-center gap-4"
              >
                <div
                  class="size-16 rounded-xl bg-cover bg-center border border-slate-100 dark:border-slate-600 shrink-0"
                  style="background-image: url('{{ club[2] if club[2] else 'https://loremflickr.com/200/200/nature?lock=' ~ club[0] }}');"
                ></div>
                <div class="flex-1 min-w-0">
                  <h4
                    class="font-bold text-lg text-slate-900 dark:text-white truncate group-hover:text-primary transition-colors"
                  >
                    {{ club[1] }}
                  </h4>
                  <div
                    class="flex items-center gap-3 text-xs text-slate-500 font-medium mt-1"
                  >
                    <span class="flex items-center gap-1"
                      ><span class="material-symbols-outlined text-[14px]"
                        >group</span
                      >
                      {{ club[3] }} √úye</span
                    >
                    {% if club[4] == 'admin' %}
                    <span
                      class="bg-amber-100 text-amber-700 px-2 py-0.5 rounded text-[10px] font-bold uppercase"
                      >Y√∂netici</span
                    >
                    {% else %}
                    <span
                      class="bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 px-2 py-0.5 rounded text-[10px] font-bold uppercase"
                      >√úye</span
                    >
                    {% endif %}
                  </div>
                </div>
                <span
                  class="material-symbols-outlined text-slate-300 group-hover:text-primary transition-colors"
                  >chevron_right</span
                >
              </div>
            </a>
            {% endfor %} {% else %}
            <div
              class="col-span-2 text-center py-8 bg-slate-50 dark:bg-slate-800/50 rounded-2xl border border-dashed border-slate-200 dark:border-slate-700"
            >
              <div
                class="inline-flex items-center justify-center size-12 rounded-full bg-slate-100 dark:bg-slate-700 text-slate-400 mb-3"
              >
                <span class="material-symbols-outlined text-2xl">groups_3</span>
              </div>
              <p class="text-sm text-slate-500 font-medium">
                Hen√ºz bir kul√ºbe katƒ±lmadƒ±n.
              </p>
              <a
                href="{{ url_for('main.create_club') }}"
                class="text-primary text-sm font-bold hover:underline mt-2 inline-block"
                >Bir tane olu≈ütur!</a
              >
            </div>
            {% endif %}
          </div>
        </div>
      </main>
    </div>
  </div>
</div>

<script>
  // Ana Sekmeler
  function switchTab(tabName) {
    const contents = document.querySelectorAll(".tab-content");
    contents.forEach((content) => content.classList.add("hidden"));

    document.getElementById("content-" + tabName).classList.remove("hidden");

    // [G√úNCELLENDƒ∞] Clubs da eklendi
    if (tabName === "routes" || tabName === "events" || tabName === "clubs") {
      document.getElementById("content-" + tabName).classList.add("block");
    }

    const buttons = document.querySelectorAll(".tab-btn");
    buttons.forEach((btn) => {
      btn.classList.remove(
        "border-primary",
        "text-[#131614]",
        "dark:text-white"
      );
      btn.classList.add("border-transparent", "text-sage-text");
    });

    const activeBtn = document.getElementById("tab-" + tabName);
    activeBtn.classList.remove("border-transparent", "text-sage-text");
    activeBtn.classList.add(
      "border-primary",
      "text-[#131614]",
      "dark:text-white"
    );
  }

  // Etkinlikler Alt Sekmeleri
  function switchEventSubTab(subTabName) {
    const subContents = document.querySelectorAll(".event-subcontent");
    subContents.forEach((content) => content.classList.add("hidden"));

    document
      .getElementById("event-content-" + subTabName)
      .classList.remove("hidden");

    const subButtons = document.querySelectorAll(".subtab-btn");
    subButtons.forEach((btn) => {
      btn.classList.remove("bg-primary", "text-white");
      btn.classList.add(
        "bg-gray-100",
        "text-slate-600",
        "hover:bg-gray-200",
        "dark:bg-slate-800",
        "dark:text-slate-300"
      );
    });

    const activeBtn = document.getElementById("subtab-" + subTabName);
    activeBtn.classList.remove(
      "bg-gray-100",
      "text-slate-600",
      "hover:bg-gray-200",
      "dark:bg-slate-800",
      "dark:text-slate-300"
    );
    activeBtn.classList.add("bg-primary", "text-white");
  }
</script>
{% endblock %}
